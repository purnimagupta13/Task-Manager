<h3 class="mt-3">Admin Dashboard</h3>

<!-- top stats row -->
<div class="row g-3 mt-1">
  <div class="col-md-4">
    <div class="card p-3 text-center shadow-sm h-100">
      <h5>Total Users</h5>
      <div class="display-6">{{ totalUsers }}</div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="card p-3 text-center shadow-sm h-100">
      <h5>Total Tasks</h5>
      <div class="display-6">{{ totalTasks }}</div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="card p-3 shadow-sm h-100">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h5 class="mb-0">Recent Activity</h5>
        <small class="text-muted">last 3</small>
      </div>

      <ng-container *ngIf="recentActivity?.length; else noActivity">
        <ul class="list-group list-group-flush">
          <li class="list-group-item px-0" *ngFor="let a of recentActivity">
            <div class="d-flex justify-content-between">
              <div class="me-3">
                <div class="fw-semibold">{{ a.user }}</div>
                <div class="small text-muted">{{ a.action }}</div>
              </div>
              <div class="text-nowrap small text-muted">
                {{ a.timestamp | date: 'short' }}
              </div>
            </div>
          </li>
        </ul>
      </ng-container>
      <ng-template #noActivity>
        <div class="text-muted small">No recent activity</div>
      </ng-template>
    </div>
  </div>
</div>

<!-- feedback / alerts -->
<div *ngIf="feedbackMsg" class="alert alert-info mt-3 py-2 mb-0">{{ feedbackMsg }}</div>

<!-- user management -->
<div class="card p-3 mt-3 shadow-sm">
  <h5 class="mb-3">User Management</h5>

  <div class="table-responsive">
    <table class="table table-striped table-hover align-middle mb-0">
      <thead>
        <tr>
          <th style="min-width: 160px;">Name</th>
          <th style="min-width: 220px;">Email</th>
          <th style="min-width: 120px;">Role</th>
          <th class="text-end" style="min-width: 150px;">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let u of pagedUsers">
          <td>
            {{ (u.firstName || '') + (u.lastName ? ' ' + u.lastName : '') | titlecase }}
          </td>
          <td>{{ u.email }}</td>
          <td>{{ u.role }}</td>
          <td class="text-end">
            <button class="btn btn-sm btn-warning me-2" (click)="openEdit(u)">Edit</button>
            <button class="btn btn-sm btn-danger" (click)="deleteUser(u.email)">Delete</button>
          </td>
        </tr>
        <tr *ngIf="users.length === 0">
          <td colspan="4" class="text-center text-muted">No users</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- pagination -->
  <div class="d-flex justify-content-between align-items-center mt-3">
    <button class="btn btn-outline-secondary btn-sm" (click)="prevPage()" [disabled]="page === 1">
      Previous
    </button>
    <div class="small">
      Page {{ page }} / {{ totalPages }}
    </div>
    <button class="btn btn-outline-secondary btn-sm" (click)="nextPage()" [disabled]="page >= totalPages">
      Next
    </button>
  </div>
</div>

<!-- simple edit overlay (no Bootstrap JS needed) -->
<div class="position-fixed top-0 start-0 w-100 h-100"
     *ngIf="showEdit"
     style="background: rgba(0,0,0,0.35); z-index: 1050;">
  <div class="card shadow p-3"
       style="max-width: 560px; width: 92%; margin: 10vh auto; border-radius: 0.75rem;">
    <h5 class="mb-3">Edit User</h5>

    <form (ngSubmit)="saveEdit()">
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">First Name</label>
          <input class="form-control" [(ngModel)]="editModel.firstName" name="firstName">
        </div>
        <div class="col-md-6">
          <label class="form-label">Last Name</label>
          <input class="form-control" [(ngModel)]="editModel.lastName" name="lastName">
        </div>
        <div class="col-md-6">
          <label class="form-label">Phone</label>
          <input class="form-control" [(ngModel)]="editModel.phone" name="phone">
        </div>
        <div class="col-md-6">
          <label class="form-label">Address</label>
          <input class="form-control" [(ngModel)]="editModel.address" name="address">
        </div>
      </div>

      <div class="d-flex justify-content-end mt-3">
        <button type="button" class="btn btn-outline-secondary me-2" (click)="cancelEdit()">Cancel</button>
        <button type="submit" class="btn btn-primary">Save</button>
      </div>
      <div class="form-text mt-2">
        Email, role, and password are not editable here.
      </div>
    </form>
  </div>
</div>
